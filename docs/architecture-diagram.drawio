<mxfile host="app.diagrams.net" modified="2026-02-01T00:00:00.000Z" agent="draw.io" version="24.0.0" type="device">
  <diagram id="arch-diagram" name="AI Healthcare Architecture">
    <mxGraphModel dx="2800" dy="3600" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="0" pageScale="1" pageWidth="3300" pageHeight="4400" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- ================================================================== -->
        <!-- CLIENT LAYER                                                       -->
        <!-- ================================================================== -->
        <mxCell id="client-group" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;dashed=1;dashPattern=5 5;verticalAlign=top;fontSize=13;arcSize=6;" vertex="1" parent="1">
          <mxGeometry x="40" y="30" width="1520" height="310" as="geometry" />
        </mxCell>
        <mxCell id="client-label" value="CLIENT LAYER" style="text;html=1;fontSize=16;fontStyle=1;fillColor=none;align=left;verticalAlign=top;strokeColor=none;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="60" y="40" width="200" height="30" as="geometry" />
        </mxCell>

        <!-- React SPA box -->
        <mxCell id="react-spa" value="&lt;b&gt;React SPA&lt;/b&gt;&lt;br&gt;Port 3055&lt;br&gt;&lt;i&gt;Material-UI&lt;/i&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=13;verticalAlign=middle;spacingTop=4;" vertex="1" parent="1">
          <mxGeometry x="60" y="80" width="180" height="70" as="geometry" />
        </mxCell>

        <!-- Libraries -->
        <mxCell id="react-libs" value="&lt;b&gt;Libraries&lt;/b&gt;&lt;br&gt;React Router v6 | Zustand&lt;br&gt;Recharts | Axios" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="60" y="170" width="180" height="60" as="geometry" />
        </mxCell>

        <!-- Pages row 1 -->
        <mxCell id="page-dashboard" value="Dashboard" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#BBDEFB;strokeColor=#6c8ebf;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="270" y="80" width="110" height="32" as="geometry" />
        </mxCell>
        <mxCell id="page-patients" value="Patients" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#BBDEFB;strokeColor=#6c8ebf;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="390" y="80" width="110" height="32" as="geometry" />
        </mxCell>
        <mxCell id="page-patientdetail" value="PatientDetail" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#BBDEFB;strokeColor=#6c8ebf;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="510" y="80" width="110" height="32" as="geometry" />
        </mxCell>
        <mxCell id="page-assessments" value="Assessments" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#BBDEFB;strokeColor=#6c8ebf;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="630" y="80" width="110" height="32" as="geometry" />
        </mxCell>
        <mxCell id="page-workflows" value="Workflows" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#BBDEFB;strokeColor=#6c8ebf;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="750" y="80" width="110" height="32" as="geometry" />
        </mxCell>
        <mxCell id="page-workflowdetail" value="WorkflowDetail" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#BBDEFB;strokeColor=#6c8ebf;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="870" y="80" width="110" height="32" as="geometry" />
        </mxCell>
        <mxCell id="page-fairness" value="Fairness" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#BBDEFB;strokeColor=#6c8ebf;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="990" y="80" width="110" height="32" as="geometry" />
        </mxCell>

        <!-- Pages row 2 -->
        <mxCell id="page-whatif" value="WhatIf" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#BBDEFB;strokeColor=#6c8ebf;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="270" y="122" width="110" height="32" as="geometry" />
        </mxCell>
        <mxCell id="page-policies" value="Policies" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#BBDEFB;strokeColor=#6c8ebf;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="390" y="122" width="110" height="32" as="geometry" />
        </mxCell>
        <mxCell id="page-governance" value="Governance" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#BBDEFB;strokeColor=#6c8ebf;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="510" y="122" width="110" height="32" as="geometry" />
        </mxCell>
        <mxCell id="page-agents" value="Agents" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#BBDEFB;strokeColor=#6c8ebf;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="630" y="122" width="110" height="32" as="geometry" />
        </mxCell>
        <mxCell id="page-audit" value="Audit" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#BBDEFB;strokeColor=#6c8ebf;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="750" y="122" width="110" height="32" as="geometry" />
        </mxCell>
        <mxCell id="page-notifications" value="Notifications" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#BBDEFB;strokeColor=#6c8ebf;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="870" y="122" width="110" height="32" as="geometry" />
        </mxCell>

        <!-- Pages label -->
        <mxCell id="pages-label" value="&lt;b&gt;13 Pages&lt;/b&gt;" style="text;html=1;fontSize=12;fillColor=none;align=left;verticalAlign=middle;strokeColor=none;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="270" y="48" width="100" height="26" as="geometry" />
        </mxCell>

        <!-- User icon -->
        <mxCell id="user-icon" value="&lt;b&gt;User&lt;/b&gt;&lt;br&gt;(Browser)" style="shape=mxgraph.basic.smiley;fillColor=#dae8fc;strokeColor=#6c8ebf;dx=0.65;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="1380" y="80" width="60" height="60" as="geometry" />
        </mxCell>
        <!-- WebSocket indicator -->
        <mxCell id="ws-indicator" value="&lt;b&gt;WebSocket&lt;/b&gt;&lt;br&gt;Real-time notifications" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E3F2FD;strokeColor=#6c8ebf;fontSize=10;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="1140" y="170" width="170" height="50" as="geometry" />
        </mxCell>

        <!-- Arrow: user to SPA -->
        <mxCell id="arrow-user-spa" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;exitX=0;exitY=0.5;entryX=1;entryY=0.25;strokeColor=#6c8ebf;strokeWidth=2;" edge="1" source="user-icon" target="react-spa" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1200" y="110" />
              <mxPoint x="1200" y="98" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- ================================================================== -->
        <!-- API GATEWAY LAYER                                                  -->
        <!-- ================================================================== -->
        <mxCell id="gateway-group" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;dashed=1;dashPattern=5 5;verticalAlign=top;fontSize=13;arcSize=6;" vertex="1" parent="1">
          <mxGeometry x="40" y="380" width="1520" height="180" as="geometry" />
        </mxCell>
        <mxCell id="gateway-label" value="API GATEWAY LAYER" style="text;html=1;fontSize=16;fontStyle=1;fillColor=none;align=left;verticalAlign=top;strokeColor=none;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="60" y="390" width="250" height="30" as="geometry" />
        </mxCell>

        <!-- Nginx -->
        <mxCell id="nginx" value="&lt;b&gt;Nginx Reverse Proxy&lt;/b&gt;&lt;br&gt;Port 3055&lt;br&gt;&lt;hr&gt;Routes: /api, /mcp, /a2a" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=12;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="100" y="430" width="260" height="90" as="geometry" />
        </mxCell>

        <!-- Route labels -->
        <mxCell id="route-api" value="/api/*" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#C8E6C9;strokeColor=#82b366;fontSize=11;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="430" y="425" width="80" height="30" as="geometry" />
        </mxCell>
        <mxCell id="route-mcp" value="/mcp/*" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#C8E6C9;strokeColor=#82b366;fontSize=11;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="430" y="460" width="80" height="30" as="geometry" />
        </mxCell>
        <mxCell id="route-a2a" value="/a2a/*" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#C8E6C9;strokeColor=#82b366;fontSize=11;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="430" y="495" width="80" height="30" as="geometry" />
        </mxCell>

        <!-- Node.js BFF Gateway -->
        <mxCell id="node-bff" value="&lt;b&gt;Node.js BFF Gateway&lt;/b&gt;&lt;br&gt;Port 4055&lt;br&gt;&lt;hr&gt;http-proxy-middleware&lt;br&gt;Request aggregation" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=12;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="580" y="420" width="260" height="110" as="geometry" />
        </mxCell>

        <!-- Arrows: Nginx routes -->
        <mxCell id="arrow-nginx-api" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;exitX=1;exitY=0.3;entryX=0;entryY=0.5;strokeColor=#82b366;strokeWidth=1.5;" edge="1" source="nginx" target="route-api" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow-nginx-mcp" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;exitX=1;exitY=0.5;entryX=0;entryY=0.5;strokeColor=#82b366;strokeWidth=1.5;" edge="1" source="nginx" target="route-mcp" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow-nginx-a2a" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;exitX=1;exitY=0.7;entryX=0;entryY=0.5;strokeColor=#82b366;strokeWidth=1.5;" edge="1" source="nginx" target="route-a2a" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow-routes-bff" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;exitX=1;exitY=0.5;entryX=0;entryY=0.5;strokeColor=#82b366;strokeWidth=1.5;" edge="1" source="route-api" target="node-bff" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Arrow: SPA to Nginx -->
        <mxCell id="arrow-spa-nginx" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;strokeColor=#333333;strokeWidth=2;startFill=0;endFill=1;" edge="1" source="react-spa" target="nginx" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="150" y="360" />
              <mxPoint x="230" y="360" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="arrow-spa-nginx-label" value="HTTP / WS" style="edgeLabel;html=1;align=center;verticalAlign=middle;fontSize=10;fontStyle=1;fontColor=#333333;" vertex="1" connectable="0" parent="arrow-spa-nginx">
          <mxGeometry x="-0.1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>

        <!-- ================================================================== -->
        <!-- BACKEND SERVICES LAYER                                             -->
        <!-- ================================================================== -->
        <mxCell id="backend-group" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;dashed=1;dashPattern=5 5;verticalAlign=top;fontSize=13;arcSize=6;" vertex="1" parent="1">
          <mxGeometry x="40" y="600" width="1520" height="240" as="geometry" />
        </mxCell>
        <mxCell id="backend-label" value="BACKEND SERVICES LAYER" style="text;html=1;fontSize=16;fontStyle=1;fillColor=none;align=left;verticalAlign=top;strokeColor=none;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="60" y="610" width="300" height="30" as="geometry" />
        </mxCell>

        <!-- Django -->
        <mxCell id="django" value="&lt;b&gt;Django + Daphne ASGI&lt;/b&gt;&lt;br&gt;Port 8055&lt;br&gt;&lt;hr&gt;REST API + WebSocket&lt;br&gt;Django Channels" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="100" y="650" width="280" height="110" as="geometry" />
        </mxCell>

        <!-- Celery Worker -->
        <mxCell id="celery-worker" value="&lt;b&gt;Celery Worker&lt;/b&gt;&lt;br&gt;&lt;hr&gt;Queues:&lt;br&gt;&lt;code&gt;default&lt;/code&gt; | &lt;code&gt;agents&lt;/code&gt; | &lt;code&gt;analytics&lt;/code&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="480" y="650" width="280" height="110" as="geometry" />
        </mxCell>

        <!-- Celery Beat -->
        <mxCell id="celery-beat" value="&lt;b&gt;Celery Beat&lt;/b&gt;&lt;br&gt;&lt;hr&gt;django_celery_beat&lt;br&gt;DatabaseScheduler" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="860" y="650" width="240" height="110" as="geometry" />
        </mxCell>

        <!-- Arrow: BFF to Django -->
        <mxCell id="arrow-bff-django" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;strokeColor=#333333;strokeWidth=2;" edge="1" source="node-bff" target="django" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="710" y="580" />
              <mxPoint x="240" y="580" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="arrow-bff-django-label" value="HTTP Proxy" style="edgeLabel;html=1;align=center;verticalAlign=middle;fontSize=10;fontStyle=1;fontColor=#333333;" vertex="1" connectable="0" parent="arrow-bff-django">
          <mxGeometry x="-0.2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>

        <!-- Arrow: Django to Celery Worker -->
        <mxCell id="arrow-django-celery" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;exitX=1;exitY=0.5;entryX=0;entryY=0.5;strokeColor=#d6b656;strokeWidth=2;" edge="1" source="django" target="celery-worker" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow-django-celery-label" value="Task dispatch&lt;br&gt;(via Redis)" style="edgeLabel;html=1;align=center;verticalAlign=middle;fontSize=10;fontColor=#333333;" vertex="1" connectable="0" parent="arrow-django-celery">
          <mxGeometry x="-0.1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>

        <!-- Arrow: Celery Beat to Celery Worker -->
        <mxCell id="arrow-beat-worker" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;exitX=0;exitY=0.5;entryX=1;entryY=0.5;strokeColor=#d6b656;strokeWidth=2;" edge="1" source="celery-beat" target="celery-worker" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow-beat-worker-label" value="Scheduled tasks" style="edgeLabel;html=1;align=center;verticalAlign=middle;fontSize=10;fontColor=#333333;" vertex="1" connectable="0" parent="arrow-beat-worker">
          <mxGeometry x="-0.1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>

        <!-- ================================================================== -->
        <!-- PROTOCOL SERVICES LAYER                                            -->
        <!-- ================================================================== -->
        <mxCell id="protocol-group" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;dashed=1;dashPattern=5 5;verticalAlign=top;fontSize=13;arcSize=6;" vertex="1" parent="1">
          <mxGeometry x="40" y="880" width="1520" height="310" as="geometry" />
        </mxCell>
        <mxCell id="protocol-label" value="PROTOCOL SERVICES LAYER" style="text;html=1;fontSize=16;fontStyle=1;fillColor=none;align=left;verticalAlign=top;strokeColor=none;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="60" y="890" width="300" height="30" as="geometry" />
        </mxCell>

        <!-- MCP Server -->
        <mxCell id="mcp-server" value="&lt;b&gt;MCP Server&lt;/b&gt;&lt;br&gt;Port 9055" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=13;fontStyle=0;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="80" y="930" width="200" height="55" as="geometry" />
        </mxCell>

        <!-- MCP Tools -->
        <mxCell id="mcp-tools-label" value="&lt;b&gt;8 Tools&lt;/b&gt;" style="text;html=1;fontSize=11;fillColor=none;align=left;verticalAlign=middle;strokeColor=none;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="80" y="995" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="mcp-tool-1" value="screen_patient" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#D1C4E9;strokeColor=#9673a6;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="80" y="1018" width="130" height="24" as="geometry" />
        </mxCell>
        <mxCell id="mcp-tool-2" value="run_screening_workflow" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#D1C4E9;strokeColor=#9673a6;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="220" y="1018" width="150" height="24" as="geometry" />
        </mxCell>
        <mxCell id="mcp-tool-3" value="get_patient_risk_card" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#D1C4E9;strokeColor=#9673a6;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="80" y="1048" width="130" height="24" as="geometry" />
        </mxCell>
        <mxCell id="mcp-tool-4" value="analyze_fairness" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#D1C4E9;strokeColor=#9673a6;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="220" y="1048" width="150" height="24" as="geometry" />
        </mxCell>
        <mxCell id="mcp-tool-5" value="what_if_policy" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#D1C4E9;strokeColor=#9673a6;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="80" y="1078" width="130" height="24" as="geometry" />
        </mxCell>
        <mxCell id="mcp-tool-6" value="review_assessment" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#D1C4E9;strokeColor=#9673a6;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="220" y="1078" width="150" height="24" as="geometry" />
        </mxCell>
        <mxCell id="mcp-tool-7" value="get_workflow_metrics" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#D1C4E9;strokeColor=#9673a6;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="80" y="1108" width="130" height="24" as="geometry" />
        </mxCell>
        <mxCell id="mcp-tool-8" value="summarize_note" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#D1C4E9;strokeColor=#9673a6;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="220" y="1108" width="150" height="24" as="geometry" />
        </mxCell>

        <!-- MCP Resources -->
        <mxCell id="mcp-res-label" value="&lt;b&gt;5 Resources&lt;/b&gt;" style="text;html=1;fontSize=11;fillColor=none;align=left;verticalAlign=middle;strokeColor=none;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="400" y="930" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="mcp-res-1" value="patients" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#D1C4E9;strokeColor=#9673a6;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="400" y="955" width="100" height="26" as="geometry" />
        </mxCell>
        <mxCell id="mcp-res-2" value="assessments" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#D1C4E9;strokeColor=#9673a6;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="510" y="955" width="100" height="26" as="geometry" />
        </mxCell>
        <mxCell id="mcp-res-3" value="policies" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#D1C4E9;strokeColor=#9673a6;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="400" y="988" width="100" height="26" as="geometry" />
        </mxCell>
        <mxCell id="mcp-res-4" value="governance" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#D1C4E9;strokeColor=#9673a6;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="510" y="988" width="100" height="26" as="geometry" />
        </mxCell>
        <mxCell id="mcp-res-5" value="audit_logs" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#D1C4E9;strokeColor=#9673a6;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="400" y="1021" width="100" height="26" as="geometry" />
        </mxCell>

        <!-- A2A Gateway -->
        <mxCell id="a2a-gateway" value="&lt;b&gt;A2A Gateway&lt;/b&gt;&lt;br&gt;Port 9155" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=13;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="720" y="930" width="200" height="55" as="geometry" />
        </mxCell>

        <!-- A2A details -->
        <mxCell id="a2a-agents" value="&lt;b&gt;5 Registered Agents&lt;/b&gt;" style="text;html=1;fontSize=11;fillColor=none;align=left;verticalAlign=middle;strokeColor=none;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="720" y="995" width="160" height="20" as="geometry" />
        </mxCell>
        <mxCell id="a2a-lifecycle" value="&lt;b&gt;Task Lifecycle&lt;/b&gt;&lt;br&gt;pending → running → completed / failed" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#D1C4E9;strokeColor=#9673a6;fontSize=10;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="720" y="1020" width="280" height="45" as="geometry" />
        </mxCell>

        <!-- Lifecycle state flow -->
        <mxCell id="state-pending" value="pending" style="ellipse;whiteSpace=wrap;html=1;fillColor=#EDE7F6;strokeColor=#9673a6;fontSize=10;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="720" y="1080" width="80" height="35" as="geometry" />
        </mxCell>
        <mxCell id="state-running" value="running" style="ellipse;whiteSpace=wrap;html=1;fillColor=#EDE7F6;strokeColor=#9673a6;fontSize=10;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="830" y="1080" width="80" height="35" as="geometry" />
        </mxCell>
        <mxCell id="state-completed" value="completed" style="ellipse;whiteSpace=wrap;html=1;fillColor=#C8E6C9;strokeColor=#82b366;fontSize=10;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="940" y="1065" width="80" height="35" as="geometry" />
        </mxCell>
        <mxCell id="state-failed" value="failed" style="ellipse;whiteSpace=wrap;html=1;fillColor=#FFCDD2;strokeColor=#b85450;fontSize=10;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="940" y="1105" width="80" height="35" as="geometry" />
        </mxCell>
        <mxCell id="arrow-pend-run" style="rounded=1;exitX=1;exitY=0.5;entryX=0;entryY=0.5;strokeColor=#9673a6;strokeWidth=1.5;" edge="1" source="state-pending" target="state-running" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow-run-comp" style="rounded=1;exitX=1;exitY=0.3;entryX=0;entryY=0.5;strokeColor=#82b366;strokeWidth=1.5;" edge="1" source="state-running" target="state-completed" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow-run-fail" style="rounded=1;exitX=1;exitY=0.7;entryX=0;entryY=0.5;strokeColor=#b85450;strokeWidth=1.5;" edge="1" source="state-running" target="state-failed" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- External agents -->
        <mxCell id="external-agents" value="&lt;b&gt;External Agents&lt;/b&gt;&lt;br&gt;(MCP / A2A clients)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="1200" y="940" width="180" height="55" as="geometry" />
        </mxCell>
        <mxCell id="arrow-ext-mcp" style="edgeStyle=orthogonalEdgeStyle;rounded=1;exitX=0;exitY=0.3;entryX=1;entryY=0.5;strokeColor=#9673a6;strokeWidth=1.5;dashed=1;" edge="1" source="external-agents" target="mcp-server" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1150" y="952" />
              <mxPoint x="1150" y="958" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="arrow-ext-a2a" style="edgeStyle=orthogonalEdgeStyle;rounded=1;exitX=0;exitY=0.7;entryX=1;entryY=0.5;strokeColor=#9673a6;strokeWidth=1.5;dashed=1;" edge="1" source="external-agents" target="a2a-gateway" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1100" y="979" />
              <mxPoint x="1100" y="958" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Arrow: MCP/A2A to Django -->
        <mxCell id="arrow-mcp-django" style="edgeStyle=orthogonalEdgeStyle;rounded=1;exitX=0.5;exitY=0;entryX=0.2;entryY=1;strokeColor=#9673a6;strokeWidth=1.5;" edge="1" source="mcp-server" target="django" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="180" y="870" />
              <mxPoint x="156" y="870" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="arrow-a2a-django" style="edgeStyle=orthogonalEdgeStyle;rounded=1;exitX=0.5;exitY=0;entryX=0.8;entryY=1;strokeColor=#9673a6;strokeWidth=1.5;" edge="1" source="a2a-gateway" target="django" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="820" y="870" />
              <mxPoint x="324" y="870" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- ================================================================== -->
        <!-- MULTI-AGENT PIPELINE (inside Celery Worker)                        -->
        <!-- ================================================================== -->
        <mxCell id="agent-group" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;dashed=1;dashPattern=5 5;verticalAlign=top;fontSize=13;arcSize=6;" vertex="1" parent="1">
          <mxGeometry x="40" y="1230" width="1520" height="360" as="geometry" />
        </mxCell>
        <mxCell id="agent-label" value="MULTI-AGENT PIPELINE  (runs inside Celery Worker - &lt;code&gt;agents&lt;/code&gt; queue)" style="text;html=1;fontSize=16;fontStyle=1;fillColor=none;align=left;verticalAlign=top;strokeColor=none;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="60" y="1240" width="650" height="30" as="geometry" />
        </mxCell>

        <!-- Pipeline arrow backbone -->
        <mxCell id="pipeline-backbone" value="" style="shape=flexArrow;endArrow=classic;startArrow=none;html=1;fillColor=#f8cecc;strokeColor=#b85450;width=8;endSize=6;startSize=4;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="100" y="1340" as="sourcePoint" />
            <mxPoint x="1500" y="1340" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="pipeline-label" value="Sequential Pipeline Flow" style="text;html=1;fontSize=11;fontStyle=2;fillColor=none;align=center;verticalAlign=middle;strokeColor=none;fontColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="620" y="1310" width="180" height="20" as="geometry" />
        </mxCell>

        <!-- Agent 1: RetrievalAgent -->
        <mxCell id="agent-retrieval" value="&lt;b&gt;RetrievalAgent&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=12;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="80" y="1360" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="retrieval-detail" value="&lt;b&gt;4 Gates:&lt;/b&gt;&lt;br&gt;1. MRI lesions&lt;br&gt;2. Note MS terms&lt;br&gt;3. ≥ 2 symptoms&lt;br&gt;4. ≥ 6 visits" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFEBEE;strokeColor=#b85450;fontSize=10;align=left;spacingLeft=8;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="80" y="1410" width="200" height="100" as="geometry" />
        </mxCell>

        <!-- Agent 2: PhenotypingAgentV2 -->
        <mxCell id="agent-phenotyping" value="&lt;b&gt;PhenotypingAgentV2&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=12;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="350" y="1360" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="phenotyping-detail" value="Weighted risk scoring (0-1)&lt;br&gt;with feature contributions" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFEBEE;strokeColor=#b85450;fontSize=10;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="350" y="1410" width="220" height="50" as="geometry" />
        </mxCell>

        <!-- Agent 3: NotesImagingAgent -->
        <mxCell id="agent-notes" value="&lt;b&gt;NotesImagingAgent&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=12;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="640" y="1360" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="notes-detail" value="MS / non-MS term extraction&lt;br&gt;from clinical notes" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFEBEE;strokeColor=#b85450;fontSize=10;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="640" y="1410" width="220" height="50" as="geometry" />
        </mxCell>

        <!-- Agent 4: SafetyGovernanceAgent -->
        <mxCell id="agent-safety" value="&lt;b&gt;SafetyGovernanceAgent&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=12;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="930" y="1360" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="safety-detail" value="&lt;b&gt;Flags:&lt;/b&gt;&lt;br&gt;- PHI check&lt;br&gt;- Low evidence&lt;br&gt;- Minor patient&lt;br&gt;- Contradiction" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFEBEE;strokeColor=#b85450;fontSize=10;align=left;spacingLeft=8;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="930" y="1410" width="220" height="100" as="geometry" />
        </mxCell>

        <!-- Agent 5: Coordinator -->
        <mxCell id="agent-coordinator" value="&lt;b&gt;Coordinator&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=12;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="1220" y="1360" width="250" height="40" as="geometry" />
        </mxCell>
        <mxCell id="coordinator-detail" value="&lt;b&gt;Action Decision:&lt;/b&gt;&lt;br&gt;NO_ACTION | RECOMMEND |&lt;br&gt;DRAFT | AUTO&lt;br&gt;&lt;hr&gt;Rate limiting + Safety override" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFEBEE;strokeColor=#b85450;fontSize=10;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="1220" y="1410" width="250" height="100" as="geometry" />
        </mxCell>

        <!-- Arrow: Celery Worker to Agent Pipeline -->
        <mxCell id="arrow-celery-agents" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;strokeColor=#b85450;strokeWidth=2;" edge="1" source="celery-worker" target="agent-group" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow-celery-agents-label" value="agents queue" style="edgeLabel;html=1;align=center;verticalAlign=middle;fontSize=10;fontStyle=1;fontColor=#b85450;" vertex="1" connectable="0" parent="arrow-celery-agents">
          <mxGeometry x="-0.1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>

        <!-- ================================================================== -->
        <!-- DATA LAYER                                                         -->
        <!-- ================================================================== -->
        <mxCell id="data-group" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;dashed=1;dashPattern=5 5;verticalAlign=top;fontSize=13;arcSize=6;" vertex="1" parent="1">
          <mxGeometry x="40" y="1630" width="1520" height="380" as="geometry" />
        </mxCell>
        <mxCell id="data-label" value="DATA LAYER" style="text;html=1;fontSize=16;fontStyle=1;fillColor=none;align=left;verticalAlign=top;strokeColor=none;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="60" y="1640" width="200" height="30" as="geometry" />
        </mxCell>

        <!-- PostgreSQL -->
        <mxCell id="postgresql" value="&lt;b&gt;PostgreSQL 16&lt;/b&gt;&lt;br&gt;Port 5455&lt;br&gt;Database: &lt;code&gt;ms_risk_lab&lt;/code&gt;" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=10;fillColor=#f5f5f5;strokeColor=#666666;fontSize=12;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="80" y="1685" width="220" height="80" as="geometry" />
        </mxCell>

        <!-- Django Apps / Models -->
        <mxCell id="app-core" value="&lt;b&gt;core&lt;/b&gt;&lt;br&gt;AuditLog | Notification&lt;br&gt;SystemConfig" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#EEEEEE;strokeColor=#666666;fontSize=10;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="340" y="1680" width="200" height="55" as="geometry" />
        </mxCell>
        <mxCell id="app-patients" value="&lt;b&gt;patients&lt;/b&gt;&lt;br&gt;Patient | RiskAssessment&lt;br&gt;PolicyConfiguration | WorkflowRun" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#EEEEEE;strokeColor=#666666;fontSize=10;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="340" y="1745" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="app-agents" value="&lt;b&gt;agents&lt;/b&gt;&lt;br&gt;AgentExecution" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#EEEEEE;strokeColor=#666666;fontSize=10;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="560" y="1680" width="160" height="55" as="geometry" />
        </mxCell>
        <mxCell id="app-governance" value="&lt;b&gt;governance&lt;/b&gt;&lt;br&gt;GovernanceRule&lt;br&gt;ComplianceReport" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#EEEEEE;strokeColor=#666666;fontSize=10;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="560" y="1745" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="app-analytics" value="&lt;b&gt;analytics&lt;/b&gt;&lt;br&gt;(services only)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#EEEEEE;strokeColor=#666666;fontSize=10;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="740" y="1680" width="140" height="55" as="geometry" />
        </mxCell>
        <mxCell id="apps-label" value="&lt;b&gt;Django Apps&lt;/b&gt;" style="text;html=1;fontSize=12;fillColor=none;align=left;verticalAlign=middle;strokeColor=none;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="340" y="1655" width="120" height="22" as="geometry" />
        </mxCell>

        <!-- Arrows: PostgreSQL to apps -->
        <mxCell id="arrow-pg-core" style="rounded=1;exitX=1;exitY=0.3;entryX=0;entryY=0.5;strokeColor=#666666;strokeWidth=1;" edge="1" source="postgresql" target="app-core" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow-pg-patients" style="rounded=1;exitX=1;exitY=0.7;entryX=0;entryY=0.5;strokeColor=#666666;strokeWidth=1;" edge="1" source="postgresql" target="app-patients" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Redis -->
        <mxCell id="redis" value="&lt;b&gt;Redis 7&lt;/b&gt;&lt;br&gt;Port 6399" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=10;fillColor=#f5f5f5;strokeColor=#666666;fontSize=12;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="80" y="1850" width="220" height="70" as="geometry" />
        </mxCell>

        <!-- Redis slots -->
        <mxCell id="redis-slot0" value="&lt;b&gt;Slot 0&lt;/b&gt;&lt;br&gt;Django cache" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#EEEEEE;strokeColor=#666666;fontSize=10;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="340" y="1840" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="redis-slot1" value="&lt;b&gt;Slot 1&lt;/b&gt;&lt;br&gt;Celery broker" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#EEEEEE;strokeColor=#666666;fontSize=10;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="340" y="1890" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="redis-slot2" value="&lt;b&gt;Slot 2&lt;/b&gt;&lt;br&gt;Node gateway cache" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#EEEEEE;strokeColor=#666666;fontSize=10;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="340" y="1940" width="160" height="40" as="geometry" />
        </mxCell>

        <!-- Arrows: Redis to slots -->
        <mxCell id="arrow-redis-s0" style="rounded=1;exitX=1;exitY=0.3;entryX=0;entryY=0.5;strokeColor=#666666;strokeWidth=1;" edge="1" source="redis" target="redis-slot0" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow-redis-s1" style="rounded=1;exitX=1;exitY=0.5;entryX=0;entryY=0.5;strokeColor=#666666;strokeWidth=1;" edge="1" source="redis" target="redis-slot1" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow-redis-s2" style="rounded=1;exitX=1;exitY=0.7;entryX=0;entryY=0.5;strokeColor=#666666;strokeWidth=1;" edge="1" source="redis" target="redis-slot2" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Arrow: Django to PostgreSQL -->
        <mxCell id="arrow-django-pg" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;exitX=0.3;exitY=1;entryX=0.5;entryY=0;strokeColor=#666666;strokeWidth=2;" edge="1" source="django" target="postgresql" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="184" y="1660" />
              <mxPoint x="190" y="1660" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="arrow-django-pg-label" value="ORM" style="edgeLabel;html=1;align=center;verticalAlign=middle;fontSize=10;fontStyle=1;fontColor=#666666;" vertex="1" connectable="0" parent="arrow-django-pg">
          <mxGeometry x="0.3" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>

        <!-- Arrow: Django to Redis -->
        <mxCell id="arrow-django-redis" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;exitX=0.1;exitY=1;entryX=0.3;entryY=0;strokeColor=#666666;strokeWidth=2;" edge="1" source="django" target="redis" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="128" y="1830" />
              <mxPoint x="146" y="1830" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="arrow-django-redis-label" value="Cache / Channels" style="edgeLabel;html=1;align=center;verticalAlign=middle;fontSize=10;fontStyle=1;fontColor=#666666;" vertex="1" connectable="0" parent="arrow-django-redis">
          <mxGeometry x="0.3" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>

        <!-- ================================================================== -->
        <!-- DATA FLOW LEGENDS (right side)                                     -->
        <!-- ================================================================== -->
        <mxCell id="flow-group" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#333333;dashed=0;verticalAlign=top;fontSize=13;arcSize=8;" vertex="1" parent="1">
          <mxGeometry x="960" y="1650" width="560" height="340" as="geometry" />
        </mxCell>
        <mxCell id="flow-label" value="DATA FLOWS" style="text;html=1;fontSize=15;fontStyle=1;fillColor=none;align=left;verticalAlign=top;strokeColor=none;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="980" y="1658" width="200" height="28" as="geometry" />
        </mxCell>

        <!-- Flow 1 -->
        <mxCell id="flow1-icon" value="" style="shape=flexArrow;endArrow=classic;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;width=6;endSize=4;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="990" y="1710" as="sourcePoint" />
            <mxPoint x="1050" y="1710" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="flow1-text" value="&lt;b&gt;HTTP Request:&lt;/b&gt; User → React SPA → Nginx → Node Gateway → Django API" style="text;html=1;fontSize=11;fillColor=none;align=left;verticalAlign=middle;strokeColor=none;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1060" y="1695" width="440" height="30" as="geometry" />
        </mxCell>

        <!-- Flow 2 -->
        <mxCell id="flow2-icon" value="" style="shape=flexArrow;endArrow=classic;html=1;fillColor=#fff2cc;strokeColor=#d6b656;width=6;endSize=4;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="990" y="1750" as="sourcePoint" />
            <mxPoint x="1050" y="1750" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="flow2-text" value="&lt;b&gt;WebSocket:&lt;/b&gt; Django → Channels (Redis) → React SPA" style="text;html=1;fontSize=11;fillColor=none;align=left;verticalAlign=middle;strokeColor=none;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1060" y="1735" width="440" height="30" as="geometry" />
        </mxCell>

        <!-- Flow 3 -->
        <mxCell id="flow3-icon" value="" style="shape=flexArrow;endArrow=classic;html=1;fillColor=#f8cecc;strokeColor=#b85450;width=6;endSize=4;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="990" y="1790" as="sourcePoint" />
            <mxPoint x="1050" y="1790" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="flow3-text" value="&lt;b&gt;Workflow:&lt;/b&gt; API → Celery Task → Agent Pipeline →&lt;br&gt;RiskAssessments → Notifications" style="text;html=1;fontSize=11;fillColor=none;align=left;verticalAlign=middle;strokeColor=none;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1060" y="1775" width="440" height="35" as="geometry" />
        </mxCell>

        <!-- Flow 4 -->
        <mxCell id="flow4-icon" value="" style="shape=flexArrow;endArrow=classic;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;width=6;endSize=4;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="990" y="1835" as="sourcePoint" />
            <mxPoint x="1050" y="1835" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="flow4-text" value="&lt;b&gt;MCP / A2A:&lt;/b&gt; External agents → MCP/A2A endpoints → Django backend" style="text;html=1;fontSize=11;fillColor=none;align=left;verticalAlign=middle;strokeColor=none;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1060" y="1820" width="440" height="30" as="geometry" />
        </mxCell>

        <!-- Color Legend -->
        <mxCell id="legend-title" value="&lt;b&gt;Layer Colors&lt;/b&gt;" style="text;html=1;fontSize=12;fillColor=none;align=left;verticalAlign=middle;strokeColor=none;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="990" y="1870" width="120" height="22" as="geometry" />
        </mxCell>
        <mxCell id="leg-client" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="990" y="1896" width="18" height="14" as="geometry" />
        </mxCell>
        <mxCell id="leg-client-t" value="Client" style="text;html=1;fontSize=10;fillColor=none;align=left;verticalAlign=middle;strokeColor=none;" vertex="1" parent="1">
          <mxGeometry x="1012" y="1891" width="50" height="22" as="geometry" />
        </mxCell>
        <mxCell id="leg-gw" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="1070" y="1896" width="18" height="14" as="geometry" />
        </mxCell>
        <mxCell id="leg-gw-t" value="Gateway" style="text;html=1;fontSize=10;fillColor=none;align=left;verticalAlign=middle;strokeColor=none;" vertex="1" parent="1">
          <mxGeometry x="1092" y="1891" width="60" height="22" as="geometry" />
        </mxCell>
        <mxCell id="leg-be" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="1160" y="1896" width="18" height="14" as="geometry" />
        </mxCell>
        <mxCell id="leg-be-t" value="Backend" style="text;html=1;fontSize=10;fillColor=none;align=left;verticalAlign=middle;strokeColor=none;" vertex="1" parent="1">
          <mxGeometry x="1182" y="1891" width="60" height="22" as="geometry" />
        </mxCell>
        <mxCell id="leg-proto" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="1250" y="1896" width="18" height="14" as="geometry" />
        </mxCell>
        <mxCell id="leg-proto-t" value="Protocols" style="text;html=1;fontSize=10;fillColor=none;align=left;verticalAlign=middle;strokeColor=none;" vertex="1" parent="1">
          <mxGeometry x="1272" y="1891" width="60" height="22" as="geometry" />
        </mxCell>
        <mxCell id="leg-agent" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="1340" y="1896" width="18" height="14" as="geometry" />
        </mxCell>
        <mxCell id="leg-agent-t" value="Agents" style="text;html=1;fontSize=10;fillColor=none;align=left;verticalAlign=middle;strokeColor=none;" vertex="1" parent="1">
          <mxGeometry x="1362" y="1891" width="50" height="22" as="geometry" />
        </mxCell>
        <mxCell id="leg-data" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="1420" y="1896" width="18" height="14" as="geometry" />
        </mxCell>
        <mxCell id="leg-data-t" value="Data" style="text;html=1;fontSize=10;fillColor=none;align=left;verticalAlign=middle;strokeColor=none;" vertex="1" parent="1">
          <mxGeometry x="1442" y="1891" width="50" height="22" as="geometry" />
        </mxCell>

        <!-- Title -->
        <mxCell id="title" value="AI Healthcare Interaction Embodiment Assistant - Technical Architecture" style="text;html=1;fontSize=22;fontStyle=1;fillColor=none;align=center;verticalAlign=middle;strokeColor=none;fontColor=#1a1a1a;" vertex="1" parent="1">
          <mxGeometry x="300" y="-10" width="800" height="40" as="geometry" />
        </mxCell>

        <!-- WebSocket flow: Django -> Redis -> React SPA -->
        <mxCell id="arrow-ws-django-redis" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;strokeColor=#d6b656;strokeWidth=1.5;dashed=1;dashPattern=8 4;" edge="1" source="django" target="ws-indicator" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="240" y="640" />
              <mxPoint x="1225" y="640" />
              <mxPoint x="1225" y="350" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="arrow-ws-label" value="WebSocket&lt;br&gt;(via Redis Channels)" style="edgeLabel;html=1;align=center;verticalAlign=middle;fontSize=9;fontColor=#d6b656;fontStyle=2;" vertex="1" connectable="0" parent="arrow-ws-django-redis">
          <mxGeometry x="0.5" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
